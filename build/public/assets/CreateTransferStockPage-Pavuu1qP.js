import{q as Q,d as g,u as R,j as e,a as $,B as h,r as K,D as Y,V as G,f as H}from"./app-DRChOLyS.js";import{u as T}from"./useQuery-PpjB-SNB.js";import{u as J,A as O,f as U}from"./utils-BzyQMKcG.js";import{l as b,F as _,A as W}from"./AdminLayout-CgYzeF35.js";import{c as X}from"./transfer_stock_api-AhyhJ_4K.js";import{g as Z}from"./product_api-CnJOPHxD.js";import{g as ee}from"./storage_api-D7uWK4W4.js";import{P as re}from"./PageTransition-Ca3SZbiI.js";import{u as te,I as ae,z as ie,t as ne}from"./validators-DVmJ9Wut.js";import{P as oe}from"./PageTitle-DimwbdIk.js";import{S as C}from"./SectionHeader-DMTrun-R.js";import{F as se}from"./Form-CoY4bDSt.js";import{S as p,C as V,b as le}from"./Title-DVbCuHvN.js";import{A as me,T as E}from"./TextInput-qBzfsNLo.js";import{S as M}from"./SimpleGrid-CR4JtHv5.js";import{D as ue}from"./DatePickerInput-1gvd8nWV.js";import{S}from"./Select-C7ktlXYe.js";import{F as ce,T as fe}from"./trash-DlOVcsjn.js";import{T as de}from"./Textarea-BICgDL0R.js";import{T as i}from"./Table-DvmPKRof.js";import{N as ge}from"./NumberInput-DshG0eT7.js";import{B as be}from"./Badge-BqAXzMiZ.js";import{P as pe}from"./plus-B8lXpxzg.js";import"./pick-calendar-levels-props-BuM-Az3U.js";import"./CheckIcon-DubuhHZI.js";import"./FileButton-CaOil0d6.js";import"./react-number-format.es-D6rMK7tG.js";const Se=()=>{var D,j;const{generatedId:u}=Q().props,{data:l,isPending:c,isError:N}=T({queryKey:["storages"],queryFn:ee,select:t=>t.data}),r=te({mode:"uncontrolled",validate:ie(ne),initialValues:{id:u,reference:"",transferedAt:new Date,sourceStorageId:0,destinationStorageId:0,attachment:null,notes:"",items:[{id:-1,quantity:""}]}}),[k,B]=g.useState(null);r.watch("sourceStorageId",({value:t})=>{B(t)});const{data:o,isPending:v,isError:I}=T({queryKey:["products",{storageId:k}],queryFn:()=>Z({storageId:k||void 0}),select:t=>t.data}),f=R(),{mutate:y,isPending:A,error:s}=J({mutationFn:X,onSuccess:()=>{f.refetchQueries({queryKey:["transferStocks"]}),f.refetchQueries({queryKey:["products"]}),f.refetchQueries({queryKey:["transferStockStats"]}),G.success("Berhasil menyimpan transaksi!"),H.visit("/transfer-barang")},onError:t=>{r.setErrors(U(t.errors))}}),w=t=>{y({...t,transferedAt:Y.fromJSDate(new Date(t.transferedAt)).toISODate({format:"extended"})})},P=g.useMemo(()=>b.isEmpty(l)?[]:l==null?void 0:l.map(t=>({label:t.name,value:t.id.toString()})),[l]),F=g.useMemo(()=>b.isEmpty(o)?[]:o.map(t=>({label:`${t.name} - ${t.sku}`,value:t.id.toString()})),[o]),q=({options:t})=>t.filter(a=>{var n;return!((n=r.getValues())!=null&&n.items.some(m=>String(m.id)===String(a.value)))}),L=({options:t})=>t.filter(a=>{var n;return String((n=r.getValues())==null?void 0:n.sourceStorageId)!==String(a.value)}),z=(t,a)=>{var m,x;const n=o==null?void 0:o.find(d=>d.id===t);return((x=(m=n==null?void 0:n.stocks)==null?void 0:m.find(d=>d.storageId===a))==null?void 0:x.quantity)||0};return e.jsxDEV(e.Fragment,{children:[e.jsxDEV($,{title:"Transfer Barang"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:145,columnNumber:7},void 0),e.jsxDEV(re,{children:e.jsxDEV(se,{form:r,onSubmit:w,children:[e.jsxDEV(oe,{title:"Tambah Transfer Barang",description:"Merupakan halaman untuk menambah transfer barang baru ke dalam sistem.",children:e.jsxDEV(h,{type:"submit",loading:A,children:"Simpan"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:153,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:149,columnNumber:11},void 0),e.jsxDEV(p,{children:[e.jsxDEV(V,{shadow:"xs",children:[e.jsxDEV(C,{title:"Informasi Transfer"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:159,columnNumber:15},void 0),(s==null?void 0:s.message)&&e.jsxDEV(me,{color:"red",c:"red",icon:e.jsxDEV(ae,{},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:162,columnNumber:52},void 0),mb:"md",children:s==null?void 0:s.message},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:162,columnNumber:17},void 0),e.jsxDEV(p,{children:[e.jsxDEV(M,{cols:{base:1,md:2,lg:3},spacing:"lg",children:[e.jsxDEV(E,{placeholder:"Masukkan nomor transaksi",label:"Nomor Transaksi",withAsterisk:!0,...r.getInputProps("id")},r.key("id"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:169,columnNumber:19},void 0),e.jsxDEV(ue,{placeholder:"Pilih tanggal transfer",label:"Tanggal Transfer",withAsterisk:!0,highlightToday:!0,valueFormat:"DD MMMM YYYY",...r.getInputProps("transferedAt")},r.key("transferedAt"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:176,columnNumber:19},void 0),e.jsxDEV(E,{placeholder:"Masukkan referensi",label:"Referensi",...r.getInputProps("reference")},r.key("reference"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:185,columnNumber:19},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:168,columnNumber:17},void 0),e.jsxDEV(M,{cols:{base:1,md:2},spacing:"lg",children:[e.jsxDEV(S,{data:P,label:"Rak Penyimpanan Asal",placeholder:"Pilih rak penyimpanan barang",withAsterisk:!0,disabled:c||N,searchable:!0,descriptionProps:{component:"div"},clearable:!0,onClear:()=>{r.setFieldValue("sourceStorageId",0),r.setFieldValue("destinationStorageId",0),(r.getValues().items.length>1||r.getValues().items.some(t=>t.id!==-1))&&r.removeListItem("items",r.getValues().items.length-1)},...r.getInputProps("sourceStorageId"),onChange:t=>{r.getInputProps("sourceStorageId").onChange(t),(r.getValues().items.length>1||r.getValues().items.some(a=>a.id!==-1))&&r.removeListItem("items",r.getValues().items.length-1)}},r.key("sourceStorageId"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:193,columnNumber:19},void 0),e.jsxDEV(S,{data:P,label:"Rak Tujuan",placeholder:"Pilih rak tujuan barang",withAsterisk:!0,disabled:c||N,searchable:!0,descriptionProps:{component:"div"},clearable:!0,onClear:()=>{r.setFieldValue("destinationStorageId",0)},filter:L,...r.getInputProps("destinationStorageId"),onChange:t=>{r.getInputProps("destinationStorageId").onChange(t)}},r.key("destinationStorageId"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:224,columnNumber:19},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:192,columnNumber:17},void 0),e.jsxDEV(ce,{accept:"image/*, application/pdf",placeholder:"Pilih file lampiran",label:"Upload Lampiran",clearable:!0,...r.getInputProps("attachment"),onChange:t=>{r.getInputProps("attachment").onChange(t)}},r.key("attachment"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:244,columnNumber:17},void 0),e.jsxDEV(de,{placeholder:"Masukkan catatan tambahan",label:"Catatan",rows:3,...r.getInputProps("notes")},r.key("notes"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:255,columnNumber:17},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:167,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:158,columnNumber:13},void 0),e.jsxDEV(V,{shadow:"xs",children:[e.jsxDEV(C,{title:"List Barang"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:265,columnNumber:15},void 0),e.jsxDEV(p,{children:e.jsxDEV(i,{striped:!0,children:[e.jsxDEV(i.Thead,{children:e.jsxDEV(i.Tr,{children:[e.jsxDEV(i.Th,{children:"Aksi"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:271,columnNumber:23},void 0),e.jsxDEV(i.Th,{children:"Nama Barang"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:272,columnNumber:23},void 0),e.jsxDEV(i.Th,{children:"QTY"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:273,columnNumber:23},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:270,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:269,columnNumber:19},void 0),e.jsxDEV(i.Tbody,{children:(j=(D=r.getValues())==null?void 0:D.items)==null?void 0:j.map((t,a)=>e.jsxDEV(i.Tr,{children:[e.jsxDEV(i.Td,{align:"center",w:K(46),children:e.jsxDEV(O,{size:"lg",color:"red",onClick:()=>r.removeListItem("items",a),disabled:r.getValues().items.length===1,children:e.jsxDEV(fe,{size:16},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:286,columnNumber:29},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:280,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:279,columnNumber:25},void 0),e.jsxDEV(i.Td,{children:e.jsxDEV(S,{data:F,placeholder:"Pilih nama barang",disabled:v||I||c||b.isEmpty(r.getValues().sourceStorageId),searchable:!0,withAsterisk:!0,filter:q,...r.getInputProps(`items.${a}.id`)},r.key(`items.${a}.id`),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:290,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:289,columnNumber:25},void 0),e.jsxDEV(i.Td,{children:e.jsxDEV(_,{align:"center",gap:"sm",children:[e.jsxDEV(ge,{placeholder:"Masukkan jumlah barang",withAsterisk:!0,hideControls:!0,w:"100%",allowNegative:!1,decimalSeparator:",",thousandSeparator:".",...r.getInputProps(`items.${a}.quantity`)},r.key(`items.${a}.quantity`),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:308,columnNumber:29},void 0),e.jsxDEV(be,{className:"min-w-max !capitalize",children:["Sisa Stok:"," ",z(Number(r.getValues().items[a].id),Number(r.getValues().sourceStorageId))]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:319,columnNumber:29},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:307,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:306,columnNumber:25},void 0)]},a,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:278,columnNumber:23},void 0))},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:276,columnNumber:19},void 0),e.jsxDEV(i.Tfoot,{children:e.jsxDEV(i.Tr,{children:e.jsxDEV(i.Th,{colSpan:5,children:e.jsxDEV(le,{w:"100%",children:e.jsxDEV(h,{variant:"outline",onClick:()=>r.insertListItem("items",{id:-1,quantity:""}),leftSection:e.jsxDEV(pe,{size:16},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:343,columnNumber:42},void 0),children:"Tambah Barang"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:335,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:334,columnNumber:25},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:333,columnNumber:23},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:332,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:331,columnNumber:19},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:268,columnNumber:17},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:267,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:264,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:157,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:148,columnNumber:9},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:147,columnNumber:7},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:144,columnNumber:5},void 0)};Se.layout=u=>e.jsxDEV(W,{children:u},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/transferStocks/CreateTransferStockPage.tsx",lineNumber:360,columnNumber:44},void 0);export{Se as default};
