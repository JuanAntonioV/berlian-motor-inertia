import{q as F,d as g,u as L,j as e,a as $,B as O,r as Q,D as z,V as K,f as Y}from"./app-9RPrKl8e.js";import{u as j}from"./useQuery-DBkGj-Hz.js";import{u as H,A as J,f as U}from"./utils-DEcZ_NbZ.js";import{l as b,F as _,A as W}from"./AdminLayout-DPxhWFZx.js";import{g as X}from"./product_api-BAcHFYz0.js";import{c as Z}from"./reduction_of_good_api-B8cjb2x3.js";import{g as ee}from"./storage_api-I70ymWBt.js";import{S as h}from"./SectionHeader-BByp1ThL.js";import{P as re}from"./PageTitle-nOtKcPGd.js";import{P as oe}from"./PageTransition-Dyw4Ulu1.js";import{u as ie,I as te,z as ae,d as ne}from"./validators-DJ9JG82t.js";import{F as se}from"./Form-NdoPV3AH.js";import{S as p,C as x,b as de}from"./Title-C8hSoR4r.js";import{A as le,T as C}from"./TextInput-CKQYIJGn.js";import{S as ue}from"./SimpleGrid-BwiAAaVy.js";import{D as me}from"./DatePickerInput-Dg9_Mi43.js";import{S as V}from"./Select-DcZUZ0tT.js";import{F as ce,T as fe}from"./trash-jRgykBo0.js";import{T as ge}from"./Textarea-DB8b9Jnx.js";import{T as t}from"./Table-ClWWHpmr.js";import{N as E}from"./NumberInput-Bo7gjfL2.js";import{B as be}from"./Badge-DcPyEYDn.js";import{P as pe}from"./plus-C5cIebHT.js";import"./pick-calendar-levels-props-CXI9PJ_k.js";import"./CheckIcon-DWttf59b.js";import"./FileButton-DoXZARbu.js";import"./react-number-format.es-CJxqVQco.js";const Ne=()=>{var D,G;const{generatedId:f}=F().props,{data:u,isPending:M,isError:B}=j({queryKey:["storages"],queryFn:ee,select:o=>o.data}),r=ie({mode:"uncontrolled",validate:ae(ne),initialValues:{id:f,storageId:0,reference:"",reducedAt:new Date,attachment:null,notes:"",items:[{id:-1,quantity:"",price:""}]}}),[N,R]=g.useState(null);r.watch("storageId",({value:o})=>{R(Number(o))});const{data:a,isPending:v,isError:k}=j({queryKey:["products",{storageId:N}],queryFn:()=>X({storageId:N||void 0}),select:o=>o.data}),m=L(),{mutate:y,isPending:I,error:d}=H({mutationFn:Z,onSuccess:()=>{m.refetchQueries({queryKey:["reductionOfGoods"]}),m.refetchQueries({queryKey:["products"]}),m.refetchQueries({queryKey:["product-stock"]}),m.refetchQueries({queryKey:["reductionOfGoodStats"]}),K.success("Berhasil menyimpan transaksi!"),Y.visit("/pengeluaran-barang")},onError:o=>{r.setErrors(U(o.errors))}}),S=o=>{y({...o,reducedAt:z.fromJSDate(new Date(o.reducedAt)).toISODate({format:"extended"})})},T=g.useMemo(()=>b.isEmpty(u)?[]:u==null?void 0:u.map(o=>({label:o.name,value:o.id.toString()})),[u]),A=g.useMemo(()=>b.isEmpty(a)?[]:a.map(o=>({label:`${o.name} - ${o.sku}`,value:o.id.toString()})),[a]),w=({options:o})=>o.filter(i=>{var n;return!((n=r.getValues())!=null&&n.items.some(s=>String(s.id)===String(i.value)))}),P=(o,i)=>{var s,c;const n=a==null?void 0:a.find(l=>l.id===o);return((c=(s=n==null?void 0:n.stocks)==null?void 0:s.find(l=>l.storageId===i))==null?void 0:c.quantity)||0};return e.jsxDEV(e.Fragment,{children:[e.jsxDEV($,{title:"Pengeluaran Barang"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:136,columnNumber:7},void 0),e.jsxDEV(oe,{children:e.jsxDEV(se,{form:r,onSubmit:S,children:[e.jsxDEV(re,{title:"Tambah Pengeluaran Barang",description:"Merupakan halaman untuk menambah pengeluaran barang baru ke dalam sistem.",children:e.jsxDEV(O,{type:"submit",loading:I,children:"Simpan"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:144,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:140,columnNumber:11},void 0),e.jsxDEV(p,{children:[e.jsxDEV(x,{shadow:"xs",children:[e.jsxDEV(h,{title:"Informasi Pengeluaran"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:150,columnNumber:15},void 0),(d==null?void 0:d.message)&&e.jsxDEV(le,{color:"red",c:"red",icon:e.jsxDEV(te,{},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:153,columnNumber:52},void 0),mb:"md",children:d==null?void 0:d.message},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:153,columnNumber:17},void 0),e.jsxDEV(p,{children:[e.jsxDEV(ue,{cols:{base:1,md:2,lg:3},spacing:"lg",children:[e.jsxDEV(C,{placeholder:"Masukkan nomor transaksi",label:"Nomor Transaksi",withAsterisk:!0,...r.getInputProps("id")},r.key("id"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:160,columnNumber:19},void 0),e.jsxDEV(me,{placeholder:"Pilih tanggal penerimaan",label:"Tanggal Penerimaan",withAsterisk:!0,highlightToday:!0,valueFormat:"DD MMMM YYYY",...r.getInputProps("reducedAt")},r.key("reducedAt"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:167,columnNumber:19},void 0),e.jsxDEV(C,{placeholder:"Masukkan referensi",label:"Referensi",...r.getInputProps("reference")},r.key("reference"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:176,columnNumber:19},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:159,columnNumber:17},void 0),e.jsxDEV(V,{data:T,label:"Rak Penyimpanan Barang",placeholder:"Pilih rak penyimpanan barang",withAsterisk:!0,disabled:M||B,searchable:!0,descriptionProps:{component:"div"},clearable:!0,onClear:()=>{r.setFieldValue("storageId",0),(r.getValues().items.length>1||r.getValues().items.some(o=>o.id!==-1))&&r.removeListItem("items",r.getValues().items.length-1)},...r.getInputProps("storageId"),onChange:o=>{r.getInputProps("storageId").onChange(o),(r.getValues().items.length>1||r.getValues().items.some(i=>i.id!==-1))&&r.removeListItem("items",r.getValues().items.length-1)}},r.key("storageId"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:183,columnNumber:17},void 0),e.jsxDEV(ce,{accept:"image/*, application/pdf",placeholder:"Pilih file lampiran",label:"Upload Lampiran",clearable:!0,...r.getInputProps("attachment"),onChange:o=>{r.getInputProps("attachment").onChange(o)}},r.key("attachment"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:213,columnNumber:17},void 0),e.jsxDEV(ge,{placeholder:"Masukkan catatan tambahan",label:"Catatan",rows:3,...r.getInputProps("notes")},r.key("notes"),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:224,columnNumber:17},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:158,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:149,columnNumber:13},void 0),e.jsxDEV(x,{shadow:"xs",children:[e.jsxDEV(h,{title:"List Barang"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:234,columnNumber:15},void 0),e.jsxDEV(p,{children:e.jsxDEV(t,{striped:!0,children:[e.jsxDEV(t.Thead,{children:e.jsxDEV(t.Tr,{children:[e.jsxDEV(t.Th,{children:"Aksi"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:240,columnNumber:23},void 0),e.jsxDEV(t.Th,{children:"Nama Barang"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:241,columnNumber:23},void 0),e.jsxDEV(t.Th,{children:"QTY"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:242,columnNumber:23},void 0),e.jsxDEV(t.Th,{children:"Harga"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:243,columnNumber:23},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:239,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:238,columnNumber:19},void 0),e.jsxDEV(t.Tbody,{children:(G=(D=r.getValues())==null?void 0:D.items)==null?void 0:G.map((o,i)=>{var n;return e.jsxDEV(t.Tr,{children:[e.jsxDEV(t.Td,{align:"center",w:Q(46),children:e.jsxDEV(J,{size:"lg",color:"red",onClick:()=>r.removeListItem("items",i),disabled:r.getValues().items.length===1,children:e.jsxDEV(fe,{size:16},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:256,columnNumber:29},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:250,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:249,columnNumber:25},void 0),e.jsxDEV(t.Td,{children:e.jsxDEV(V,{data:A,placeholder:"Pilih nama barang",disabled:v||k||b.isEmpty((n=r.getValues())==null?void 0:n.storageId),searchable:!0,withAsterisk:!0,filter:w,...r.getInputProps(`items.${i}.id`),onChange:s=>{var l;r.getInputProps(`items.${i}.id`).onChange(s);const c=((l=a==null?void 0:a.find(q=>q.id===Number(s)))==null?void 0:l.salePrice)||0;r.setFieldValue(`items.${i}.price`,c)}},r.key(`items.${i}.id`),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:260,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:259,columnNumber:25},void 0),e.jsxDEV(t.Td,{children:e.jsxDEV(_,{align:"center",gap:"sm",children:[e.jsxDEV(E,{placeholder:"Masukkan jumlah barang",withAsterisk:!0,hideControls:!0,w:"100%",max:P(Number(r.getValues().items[i].id),Number(r.getValues().storageId)),allowNegative:!1,decimalSeparator:",",thousandSeparator:".",...r.getInputProps(`items.${i}.quantity`)},r.key(`items.${i}.quantity`),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:284,columnNumber:29},void 0),e.jsxDEV(be,{className:"min-w-max !capitalize",children:["Sisa Stok:"," ",P(Number(r.getValues().items[i].id),Number(r.getValues().storageId))]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:299,columnNumber:29},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:283,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:282,columnNumber:25},void 0),e.jsxDEV(t.Td,{children:e.jsxDEV(E,{placeholder:"Masukkan harga barang",withAsterisk:!0,decimalSeparator:",",thousandSeparator:".",prefix:"Rp ",allowNegative:!1,hideControls:!0,...r.getInputProps(`items.${i}.price`)},r.key(`items.${i}.price`),!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:309,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:308,columnNumber:25},void 0)]},i,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:248,columnNumber:23},void 0)})},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:246,columnNumber:19},void 0),e.jsxDEV(t.Tfoot,{children:e.jsxDEV(t.Tr,{children:e.jsxDEV(t.Th,{colSpan:4,children:e.jsxDEV(de,{w:"100%",children:e.jsxDEV(O,{variant:"outline",onClick:()=>r.insertListItem("items",{id:-1,quantity:"",price:""}),leftSection:e.jsxDEV(pe,{size:16},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:337,columnNumber:42},void 0),children:"Tambah Barang"},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:328,columnNumber:27},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:327,columnNumber:25},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:326,columnNumber:23},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:325,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:324,columnNumber:19},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:237,columnNumber:17},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:236,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:233,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:148,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:139,columnNumber:9},void 0)},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:138,columnNumber:7},void 0)]},void 0,!0,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:135,columnNumber:5},void 0)};Ne.layout=f=>e.jsxDEV(W,{children:f},void 0,!1,{fileName:"D:/Projects/Berlian Motor/berlian-motor-inertia/inertia/pages/reductionOfGoods/CreateReductionOfGoodPage.tsx",lineNumber:355,columnNumber:46},void 0);export{Ne as default};
